import json
from rich.console import Console

console = Console()


def save_results(results, filename):
    """
    Save exploit results to a file.
    Supports JSON (.json) and Markdown (.md).
    """
    try:
        if filename.endswith(".json"):
            with open(filename, 'w', encoding="utf-8") as f:
                json.dump(results, f, indent=4, ensure_ascii=False)
            console.print(f"\n[bold green][+] Results saved to JSON:[/] {filename}")

        elif filename.endswith(".md"):
            with open(filename, 'w', encoding="utf-8") as f:
                for r in results:
                    f.write(
                        f"- **{r.get('title', 'No Title')}** ({r.get('source', '-')})\n"
                        f"  [{r.get('url', '-')}]({r.get('url', '-')})\n\n"
                    )
            console.print(f"\n[bold cyan][+] Results saved to Markdown:[/] {filename}")

        else:
            console.print(
                "[bold red][-] Unsupported output format![/]\n"
                "   Use [bold yellow].json[/] or [bold yellow].md[/]"
            )

    except Exception as e:
        console.print(f"[bold red][!] Failed to save results:[/] {e}")
