import os
import requests


def search_github(keyword, max_results=15):
    """
    Search GitHub repositories for exploits by keyword.

    Args:
        keyword (str): Search term
        max_results (int): Limit results

    Returns:
        list[dict]: Repository results
    """
    results = []
    headers = {
        "Accept": "application/vnd.github.v3+json"
    }

    # Optional: support GitHub token to avoid rate limits
    token = os.getenv("GITHUB_TOKEN")
    if token:
        headers["Authorization"] = f"token {token}"

    url = f"https://api.github.com/search/repositories?q={keyword}+exploit"

    try:
        r = requests.get(url, headers=headers, timeout=10)
        r.raise_for_status()
        data = r.json()

        for repo in data.get("items", [])[:max_results]:
            results.append({
                "title": repo.get("full_name", "unknown"),
                "url": repo.get("html_url", ""),
                "source": "GitHub"
            })

    except Exception as e:
        print(f"[!] GitHub API error: {e}")

    return results
